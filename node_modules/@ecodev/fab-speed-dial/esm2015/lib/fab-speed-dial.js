/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ContentChild, ContentChildren, ElementRef, EventEmitter, HostBinding, HostListener, Inject, Injector, Input, Output, QueryList, Renderer2, ViewEncapsulation, } from '@angular/core';
import { MatButton } from '@angular/material/button';
import { DOCUMENT } from '@angular/common';
import { forkJoin, fromEvent } from 'rxjs';
import { take } from 'rxjs/operators';
/** @type {?} */
const Z_INDEX_ITEM = 23;
export class EcoFabSpeedDialActionsComponent {
    /**
     * @param {?} injector
     * @param {?} renderer
     */
    constructor(injector, renderer) {
        this.renderer = renderer;
        /**
         * Whether the min-fab button exist in DOM
         */
        this.miniFabVisible = false;
        this._parent = injector.get(EcoFabSpeedDialComponent);
    }
    /**
     * @return {?}
     */
    ngAfterContentInit() {
        this._buttons.changes.subscribe((/**
         * @return {?}
         */
        () => {
            this.initButtonStates();
            this._parent.setActionsVisibility();
        }));
        this.initButtonStates();
    }
    /**
     * @private
     * @return {?}
     */
    initButtonStates() {
        this._buttons.forEach((/**
         * @param {?} button
         * @param {?} i
         * @return {?}
         */
        (button, i) => {
            this.renderer.addClass(button._getHostElement(), 'eco-fab-action-item');
            this.changeElementStyle(button._getHostElement(), 'z-index', '' + (Z_INDEX_ITEM - i));
        }));
    }
    /**
     * @return {?}
     */
    show() {
        if (!this._buttons) {
            return;
        }
        this.resetAnimationState();
        this.miniFabVisible = true;
        this.showMiniFabAnimation = setTimeout((/**
         * @return {?}
         */
        () => {
            this._buttons.forEach((/**
             * @param {?} button
             * @param {?} i
             * @return {?}
             */
            (button, i) => {
                /** @type {?} */
                let transitionDelay = 0;
                /** @type {?} */
                let transform;
                if (this._parent.animationMode === 'scale') {
                    // Incremental transition delay of 65ms for each action button
                    transitionDelay = 3 + (65 * i);
                    transform = 'scale(1)';
                }
                else {
                    transform = this.getTranslateFunction('0');
                }
                /** @type {?} */
                const hostElement = button._getHostElement();
                this.changeElementStyle(hostElement, 'transition-delay', transitionDelay + 'ms');
                this.changeElementStyle(hostElement, 'opacity', '1');
                this.changeElementStyle(hostElement, 'transform', transform);
            }));
        }), 50); // Be sure that *ngIf can show elements before trying to animate them
    }
    /**
     * @private
     * @return {?}
     */
    resetAnimationState() {
        clearTimeout(this.showMiniFabAnimation);
        if (this.hideMiniFab) {
            this.hideMiniFab.unsubscribe();
            this.hideMiniFab = null;
        }
    }
    /**
     * @return {?}
     */
    hide() {
        if (!this._buttons) {
            return;
        }
        this.resetAnimationState();
        /** @type {?} */
        const obs = this._buttons.map((/**
         * @param {?} button
         * @param {?} i
         * @return {?}
         */
        (button, i) => {
            /** @type {?} */
            let opacity = '1';
            /** @type {?} */
            let transitionDelay = 0;
            /** @type {?} */
            let transform;
            if (this._parent.animationMode === 'scale') {
                transitionDelay = 3 - (65 * i);
                transform = 'scale(0)';
                opacity = '0';
            }
            else {
                transform = this.getTranslateFunction((55 * (i + 1) - (i * 5)) + 'px');
            }
            /** @type {?} */
            const hostElement = button._getHostElement();
            this.changeElementStyle(hostElement, 'transition-delay', transitionDelay + 'ms');
            this.changeElementStyle(hostElement, 'opacity', opacity);
            this.changeElementStyle(hostElement, 'transform', transform);
            return fromEvent(hostElement, 'transitionend').pipe(take(1));
        }));
        // Wait for all animation to finish, then destroy their elements
        this.hideMiniFab = forkJoin(obs).subscribe((/**
         * @return {?}
         */
        () => this.miniFabVisible = false));
    }
    /**
     * @private
     * @param {?} value
     * @return {?}
     */
    getTranslateFunction(value) {
        /** @type {?} */
        const dir = this._parent.direction;
        /** @type {?} */
        const translateFn = (dir === 'up' || dir === 'down') ? 'translateY' : 'translateX';
        /** @type {?} */
        const sign = (dir === 'down' || dir === 'right') ? '-' : '';
        return translateFn + '(' + sign + value + ')';
    }
    /**
     * @private
     * @param {?} elem
     * @param {?} style
     * @param {?} value
     * @return {?}
     */
    changeElementStyle(elem, style, value) {
        // FIXME - Find a way to create a "wrapper" around the action button(s) provided by the user, so we don't change it's style tag
        this.renderer.setStyle(elem, style, value);
    }
}
EcoFabSpeedDialActionsComponent.decorators = [
    { type: Component, args: [{
                selector: 'eco-fab-speed-dial-actions',
                template: `
        <ng-content select="[mat-mini-fab]" *ngIf="miniFabVisible"></ng-content>`
            }] }
];
/** @nocollapse */
EcoFabSpeedDialActionsComponent.ctorParameters = () => [
    { type: Injector },
    { type: Renderer2 }
];
EcoFabSpeedDialActionsComponent.propDecorators = {
    _buttons: [{ type: ContentChildren, args: [MatButton,] }]
};
if (false) {
    /**
     * @type {?}
     * @private
     */
    EcoFabSpeedDialActionsComponent.prototype._parent;
    /** @type {?} */
    EcoFabSpeedDialActionsComponent.prototype._buttons;
    /**
     * Whether the min-fab button exist in DOM
     * @type {?}
     */
    EcoFabSpeedDialActionsComponent.prototype.miniFabVisible;
    /**
     * The timeout ID for the callback to show the mini-fab buttons
     * @type {?}
     * @private
     */
    EcoFabSpeedDialActionsComponent.prototype.showMiniFabAnimation;
    /**
     * When we will remove mini-fab buttons from DOM, after the animation is complete
     * @type {?}
     * @private
     */
    EcoFabSpeedDialActionsComponent.prototype.hideMiniFab;
    /**
     * @type {?}
     * @private
     */
    EcoFabSpeedDialActionsComponent.prototype.renderer;
}
/**
 * \@dynamic \@see https://github.com/angular/angular/issues/20351#issuecomment-344009887
 */
export class EcoFabSpeedDialComponent {
    /**
     * @param {?} elementRef
     * @param {?} renderer
     * @param {?} document
     */
    constructor(elementRef, renderer, document) {
        this.elementRef = elementRef;
        this.renderer = renderer;
        this.document = document;
        this.isInitialized = false;
        this._direction = 'up';
        this._open = false;
        this._animationMode = 'fling';
        this._fixed = false;
        this._documentClickUnlistener = null;
        this.openChange = new EventEmitter();
    }
    /**
     * Whether this speed dial is fixed on screen (user cannot change it by clicking)
     * @return {?}
     */
    get fixed() {
        return this._fixed;
    }
    /**
     * @param {?} fixed
     * @return {?}
     */
    set fixed(fixed) {
        this._fixed = fixed;
        this._processOutsideClickState();
    }
    /**
     * Whether this speed dial is opened
     * @return {?}
     */
    get open() {
        return this._open;
    }
    /**
     * @param {?} open
     * @return {?}
     */
    set open(open) {
        /** @type {?} */
        const previousOpen = this._open;
        this._open = open;
        if (previousOpen !== this._open) {
            this.openChange.emit(this._open);
            if (this.isInitialized) {
                this.setActionsVisibility();
            }
        }
    }
    /**
     * The direction of the speed dial. Can be 'up', 'down', 'left' or 'right'
     * @return {?}
     */
    get direction() {
        return this._direction;
    }
    /**
     * @param {?} direction
     * @return {?}
     */
    set direction(direction) {
        /** @type {?} */
        const previousDirection = this._direction;
        this._direction = direction;
        if (previousDirection !== this.direction) {
            this._setElementClass(previousDirection, false);
            this._setElementClass(this.direction, true);
            if (this.isInitialized) {
                this.setActionsVisibility();
            }
        }
    }
    /**
     * The animation mode to open the speed dial. Can be 'fling' or 'scale'
     * @return {?}
     */
    get animationMode() {
        return this._animationMode;
    }
    /**
     * @param {?} animationMode
     * @return {?}
     */
    set animationMode(animationMode) {
        /** @type {?} */
        const previousAnimationMode = this._animationMode;
        this._animationMode = animationMode;
        if (previousAnimationMode !== this._animationMode) {
            this._setElementClass(previousAnimationMode, false);
            this._setElementClass(this.animationMode, true);
            if (this.isInitialized) {
                // To start another detect lifecycle and force the "close" on the action buttons
                Promise.resolve(null).then((/**
                 * @return {?}
                 */
                () => this.open = false));
            }
        }
    }
    /**
     * @return {?}
     */
    ngAfterContentInit() {
        this.isInitialized = true;
        this.setActionsVisibility();
        this._setElementClass(this.direction, true);
        this._setElementClass(this.animationMode, true);
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this._unsetDocumentClickListener();
    }
    /**
     * Toggle the open state of this speed dial
     * @return {?}
     */
    toggle() {
        this.open = !this.open;
    }
    /**
     * @return {?}
     */
    _onClick() {
        if (!this.fixed && this.open) {
            this.open = false;
        }
    }
    /**
     * @return {?}
     */
    setActionsVisibility() {
        if (!this._childActions) {
            return;
        }
        if (this.open) {
            this._childActions.show();
        }
        else {
            this._childActions.hide();
        }
        this._processOutsideClickState();
    }
    /**
     * @private
     * @param {?} elemClass
     * @param {?} isAdd
     * @return {?}
     */
    _setElementClass(elemClass, isAdd) {
        /** @type {?} */
        const finalClass = `eco-${elemClass}`;
        if (isAdd) {
            this.renderer.addClass(this.elementRef.nativeElement, finalClass);
        }
        else {
            this.renderer.removeClass(this.elementRef.nativeElement, finalClass);
        }
    }
    /**
     * @private
     * @return {?}
     */
    _processOutsideClickState() {
        if (!this.fixed && this.open) {
            this._setDocumentClickListener();
        }
        else {
            this._unsetDocumentClickListener();
        }
    }
    /**
     * @private
     * @return {?}
     */
    _setDocumentClickListener() {
        if (!this._documentClickUnlistener) {
            this._documentClickUnlistener = this.renderer.listen(this.document, 'click', (/**
             * @return {?}
             */
            () => {
                this.open = false;
            }));
        }
    }
    /**
     * @private
     * @return {?}
     */
    _unsetDocumentClickListener() {
        if (this._documentClickUnlistener) {
            this._documentClickUnlistener();
            this._documentClickUnlistener = null;
        }
    }
}
EcoFabSpeedDialComponent.decorators = [
    { type: Component, args: [{
                selector: 'eco-fab-speed-dial',
                template: `
        <div class="eco-fab-speed-dial-container">
            <ng-content select="eco-fab-speed-dial-trigger"></ng-content>
            <ng-content select="eco-fab-speed-dial-actions"></ng-content>
        </div>
    `,
                encapsulation: ViewEncapsulation.None,
                styles: ["eco-fab-speed-dial{display:inline-block}eco-fab-speed-dial.eco-opened .eco-fab-speed-dial-container eco-fab-speed-dial-trigger.eco-spin .spin180{transform:rotate(180deg)}eco-fab-speed-dial.eco-opened .eco-fab-speed-dial-container eco-fab-speed-dial-trigger.eco-spin .spin360{transform:rotate(360deg)}eco-fab-speed-dial .eco-fab-speed-dial-container{position:relative;display:flex;align-items:center;z-index:20}eco-fab-speed-dial .eco-fab-speed-dial-container eco-fab-speed-dial-trigger{pointer-events:auto;z-index:24}eco-fab-speed-dial .eco-fab-speed-dial-container eco-fab-speed-dial-trigger.eco-spin .spin180,eco-fab-speed-dial .eco-fab-speed-dial-container eco-fab-speed-dial-trigger.eco-spin .spin360{transition:.6s cubic-bezier(.4,0,.2,1)}eco-fab-speed-dial .eco-fab-speed-dial-container eco-fab-speed-dial-actions{display:flex;position:absolute;height:0;width:0}eco-fab-speed-dial.eco-fling .eco-fab-speed-dial-container eco-fab-speed-dial-actions .eco-fab-action-item{display:block;opacity:1;transition:.3s cubic-bezier(.55,0,.55,.2)}eco-fab-speed-dial.eco-scale .eco-fab-speed-dial-container eco-fab-speed-dial-actions .eco-fab-action-item{transform:scale(0);transition:.3s cubic-bezier(.55,0,.55,.2);transition-duration:.14286s}eco-fab-speed-dial.eco-down eco-fab-speed-dial-actions{bottom:2px;left:7px}eco-fab-speed-dial.eco-down .eco-fab-speed-dial-container{flex-direction:column}eco-fab-speed-dial.eco-down .eco-fab-speed-dial-container eco-fab-speed-dial-trigger{order:1}eco-fab-speed-dial.eco-down .eco-fab-speed-dial-container eco-fab-speed-dial-actions{flex-direction:column;order:2}eco-fab-speed-dial.eco-down .eco-fab-speed-dial-container eco-fab-speed-dial-actions .eco-fab-action-item{margin-top:10px}eco-fab-speed-dial.eco-up eco-fab-speed-dial-actions{top:2px;left:7px}eco-fab-speed-dial.eco-up .eco-fab-speed-dial-container{flex-direction:column}eco-fab-speed-dial.eco-up .eco-fab-speed-dial-container eco-fab-speed-dial-trigger{order:2}eco-fab-speed-dial.eco-up .eco-fab-speed-dial-container eco-fab-speed-dial-actions{flex-direction:column-reverse;order:1}eco-fab-speed-dial.eco-up .eco-fab-speed-dial-container eco-fab-speed-dial-actions .eco-fab-action-item{margin-bottom:10px}eco-fab-speed-dial.eco-left eco-fab-speed-dial-actions{top:7px;left:2px}eco-fab-speed-dial.eco-left .eco-fab-speed-dial-container{flex-direction:row}eco-fab-speed-dial.eco-left .eco-fab-speed-dial-container eco-fab-speed-dial-trigger{order:2}eco-fab-speed-dial.eco-left .eco-fab-speed-dial-container eco-fab-speed-dial-actions{flex-direction:row-reverse;order:1}eco-fab-speed-dial.eco-left .eco-fab-speed-dial-container eco-fab-speed-dial-actions .eco-fab-action-item{margin-right:10px}eco-fab-speed-dial.eco-right eco-fab-speed-dial-actions{top:7px;right:2px}eco-fab-speed-dial.eco-right .eco-fab-speed-dial-container{flex-direction:row}eco-fab-speed-dial.eco-right .eco-fab-speed-dial-container eco-fab-speed-dial-trigger{order:1}eco-fab-speed-dial.eco-right .eco-fab-speed-dial-container eco-fab-speed-dial-actions{flex-direction:row;order:2}eco-fab-speed-dial.eco-right .eco-fab-speed-dial-container eco-fab-speed-dial-actions .eco-fab-action-item{margin-left:10px}"]
            }] }
];
/** @nocollapse */
EcoFabSpeedDialComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 },
    { type: Document, decorators: [{ type: Inject, args: [DOCUMENT,] }] }
];
EcoFabSpeedDialComponent.propDecorators = {
    fixed: [{ type: Input }],
    open: [{ type: HostBinding, args: ['class.eco-opened',] }, { type: Input }],
    direction: [{ type: Input }],
    animationMode: [{ type: Input }],
    openChange: [{ type: Output }],
    _childActions: [{ type: ContentChild, args: [EcoFabSpeedDialActionsComponent, { static: false },] }],
    _onClick: [{ type: HostListener, args: ['click',] }]
};
if (false) {
    /**
     * @type {?}
     * @private
     */
    EcoFabSpeedDialComponent.prototype.isInitialized;
    /**
     * @type {?}
     * @private
     */
    EcoFabSpeedDialComponent.prototype._direction;
    /**
     * @type {?}
     * @private
     */
    EcoFabSpeedDialComponent.prototype._open;
    /**
     * @type {?}
     * @private
     */
    EcoFabSpeedDialComponent.prototype._animationMode;
    /**
     * @type {?}
     * @private
     */
    EcoFabSpeedDialComponent.prototype._fixed;
    /**
     * @type {?}
     * @private
     */
    EcoFabSpeedDialComponent.prototype._documentClickUnlistener;
    /** @type {?} */
    EcoFabSpeedDialComponent.prototype.openChange;
    /** @type {?} */
    EcoFabSpeedDialComponent.prototype._childActions;
    /**
     * @type {?}
     * @private
     */
    EcoFabSpeedDialComponent.prototype.elementRef;
    /**
     * @type {?}
     * @private
     */
    EcoFabSpeedDialComponent.prototype.renderer;
    /**
     * @type {?}
     * @private
     */
    EcoFabSpeedDialComponent.prototype.document;
}
export class EcoFabSpeedDialTriggerComponent {
    /**
     * @param {?} injector
     */
    constructor(injector) {
        this.spin = false;
        this._parent = injector.get(EcoFabSpeedDialComponent);
    }
    /**
     * Whether this trigger should spin (360dg) while opening the speed dial
     * @return {?}
     */
    get sp() {
        return this.spin;
    }
    /**
     * @param {?} event
     * @return {?}
     */
    _onClick(event) {
        if (!this._parent.fixed) {
            this._parent.toggle();
            event.stopPropagation();
        }
    }
}
EcoFabSpeedDialTriggerComponent.decorators = [
    { type: Component, args: [{
                selector: 'eco-fab-speed-dial-trigger',
                template: `
        <ng-content select="[mat-fab]"></ng-content>`
            }] }
];
/** @nocollapse */
EcoFabSpeedDialTriggerComponent.ctorParameters = () => [
    { type: Injector }
];
EcoFabSpeedDialTriggerComponent.propDecorators = {
    sp: [{ type: HostBinding, args: ['class.eco-spin',] }],
    spin: [{ type: Input }],
    _onClick: [{ type: HostListener, args: ['click', ['$event'],] }]
};
if (false) {
    /**
     * @type {?}
     * @private
     */
    EcoFabSpeedDialTriggerComponent.prototype._parent;
    /** @type {?} */
    EcoFabSpeedDialTriggerComponent.prototype.spin;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmFiLXNwZWVkLWRpYWwuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZWNvZGV2L2ZhYi1zcGVlZC1kaWFsLyIsInNvdXJjZXMiOlsibGliL2ZhYi1zcGVlZC1kaWFsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBRUgsU0FBUyxFQUNULFlBQVksRUFDWixlQUFlLEVBQ2YsVUFBVSxFQUNWLFlBQVksRUFDWixXQUFXLEVBQ1gsWUFBWSxFQUNaLE1BQU0sRUFDTixRQUFRLEVBQ1IsS0FBSyxFQUVMLE1BQU0sRUFDTixTQUFTLEVBQ1QsU0FBUyxFQUNULGlCQUFpQixHQUNwQixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDckQsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzNDLE9BQU8sRUFBRSxRQUFRLEVBQUUsU0FBUyxFQUFnQixNQUFNLE1BQU0sQ0FBQztBQUN6RCxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7O01BRWhDLFlBQVksR0FBRyxFQUFFO0FBVXZCLE1BQU0sT0FBTywrQkFBK0I7Ozs7O0lBb0J4QyxZQUFZLFFBQWtCLEVBQVUsUUFBbUI7UUFBbkIsYUFBUSxHQUFSLFFBQVEsQ0FBVzs7OztRQVpwRCxtQkFBYyxHQUFHLEtBQUssQ0FBQztRQWExQixJQUFJLENBQUMsT0FBTyxHQUFHLFFBQVEsQ0FBQyxHQUFHLENBQUMsd0JBQXdCLENBQUMsQ0FBQztJQUMxRCxDQUFDOzs7O0lBRUQsa0JBQWtCO1FBQ2QsSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsU0FBUzs7O1FBQUMsR0FBRyxFQUFFO1lBQ2pDLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1lBQ3hCLElBQUksQ0FBQyxPQUFPLENBQUMsb0JBQW9CLEVBQUUsQ0FBQztRQUN4QyxDQUFDLEVBQUMsQ0FBQztRQUVILElBQUksQ0FBQyxnQkFBZ0Is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QUFlLEVBQUUsQ0FBQztTQUMzQjtJQUNMLENBQUM7OztZQTNCSixTQUFTLFNBQUM7Z0JBQ1AsUUFBUSxFQUFFLDRCQUE0QjtnQkFDdEMsUUFBUSxFQUFFO3FEQUN1QzthQUNwRDs7OztZQWxVRyxRQUFROzs7aUJBeVVQLFdBQVcsU0FBQyxnQkFBZ0I7bUJBSTVCLEtBQUs7dUJBTUwsWUFBWSxTQUFDLE9BQU8sRUFBRSxDQUFDLFFBQVEsQ0FBQzs7Ozs7OztJQWZqQyxrREFBMEM7O0lBUzFDLCtDQUFzQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gICAgQWZ0ZXJDb250ZW50SW5pdCxcbiAgICBDb21wb25lbnQsXG4gICAgQ29udGVudENoaWxkLFxuICAgIENvbnRlbnRDaGlsZHJlbixcbiAgICBFbGVtZW50UmVmLFxuICAgIEV2ZW50RW1pdHRlcixcbiAgICBIb3N0QmluZGluZyxcbiAgICBIb3N0TGlzdGVuZXIsXG4gICAgSW5qZWN0LFxuICAgIEluamVjdG9yLFxuICAgIElucHV0LFxuICAgIE9uRGVzdHJveSxcbiAgICBPdXRwdXQsXG4gICAgUXVlcnlMaXN0LFxuICAgIFJlbmRlcmVyMixcbiAgICBWaWV3RW5jYXBzdWxhdGlvbixcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBNYXRCdXR0b24gfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC9idXR0b24nO1xuaW1wb3J0IHsgRE9DVU1FTlQgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuaW1wb3J0IHsgZm9ya0pvaW4sIGZyb21FdmVudCwgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyB0YWtlIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5jb25zdCBaX0lOREVYX0lURU0gPSAyMztcblxuZXhwb3J0IHR5cGUgRGlyZWN0aW9uID0gJ3VwJyB8ICdkb3duJyB8ICdsZWZ0JyB8ICdyaWdodCc7XG5leHBvcnQgdHlwZSBBbmltYXRpb25Nb2RlID0gJ2ZsaW5nJyB8ICdzY2FsZSc7XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAnZWNvLWZhYi1zcGVlZC1kaWFsLWFjdGlvbnMnLFxuICAgIHRlbXBsYXRlOiBgXG4gICAgICAgIDxuZy1jb250ZW50IHNlbGVjdD1cIlttYXQtbWluaS1mYWJdXCIgKm5nSWY9XCJtaW5pRmFiVmlzaWJsZVwiPjwvbmctY29udGVudD5gLFxufSlcbmV4cG9ydCBjbGFzcyBFY29GYWJTcGVlZERpYWxBY3Rpb25zQ29tcG9uZW50IGltcGxlbWVudHMgQWZ0ZXJDb250ZW50SW5pdCB7XG4gICAgcHJpdmF0ZSBfcGFyZW50OiBFY29GYWJTcGVlZERpYWxDb21wb25lbnQ7XG5cbiAgICBAQ29udGVudENoaWxkcmVuKE1hdEJ1dHRvbikgX2J1dHRvbnM6IFF1ZXJ5TGlzdDxNYXRCdXR0b24+O1xuXG4gICAgLyoqXG4gICAgICogV2hldGhlciB0aGUgbWluLWZhYiBidXR0b24gZXhpc3QgaW4gRE9NXG4gICAgICovXG4gICAgcHVibGljIG1pbmlGYWJWaXNpYmxlID0gZmFsc2U7XG5cbiAgICAvKipcbiAgICAgKiBUaGUgdGltZW91dCBJRCBmb3IgdGhlIGNhbGxiYWNrIHRvIHNob3cgdGhlIG1pbmktZmFiIGJ1dHRvbnNcbiAgICAgKi9cbiAgICBwcml2YXRlIHNob3dNaW5pRmFiQW5pbWF0aW9uOiBSZXR1cm5UeXBlPHR5cGVvZiBzZXRUaW1lb3V0PjtcblxuICAgIC8qKlxuICAgICAqIFdoZW4gd2Ugd2lsbCByZW1vdmUgbWluaS1mYWIgYnV0dG9ucyBmcm9tIERPTSwgYWZ0ZXIgdGhlIGFuaW1hdGlvbiBpcyBjb21wbGV0ZVxuICAgICAqL1xuICAgIHByaXZhdGUgaGlkZU1pbmlGYWI6IFN1YnNjcmlwdGlvbiB8IG51bGw7XG5cbiAgICBjb25zdHJ1Y3RvcihpbmplY3RvcjogSW5qZWN0b3IsIHByaXZhdGUgcmVuZGVyZXI6IFJlbmRlcmVyMikge1xuICAgICAgICB0aGlzLl9wYXJlbnQgPSBpbmplY3Rvci5nZXQoRWNvRmFiU3BlZWREaWFsQ29tcG9uZW50KTtcbiAgICB9XG5cbiAgICBuZ0FmdGVyQ29udGVudEluaXQoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuX2J1dHRvbnMuY2hhbmdlcy5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5pbml0QnV0dG9uU3RhdGVzKCk7XG4gICAgICAgICAgICB0aGlzLl9wYXJlbnQuc2V0QWN0aW9uc1Zpc2liaWxpdHkoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5pbml0QnV0dG9uU3RhdGVzKCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpbml0QnV0dG9uU3RhdGVzKCk6IHZvaWQge1xuICAgICAgICB0aGlzLl9idXR0b25zLmZvckVhY2goKGJ1dHRvbiwgaSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyhidXR0b24uX2dldEhvc3RFbGVtZW50KCksICdlY28tZmFiLWFjdGlvbi1pdGVtJyk7XG4gICAgICAgICAgICB0aGlzLmNoYW5nZUVsZW1lbnRTdHlsZShidXR0b24uX2dldEhvc3RFbGVtZW50KCksICd6LWluZGV4JywgJycgKyAoWl9JTkRFWF9JVEVNIC0gaSkpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBzaG93KCk6IHZvaWQge1xuICAgICAgICBpZiAoIXRoaXMuX2J1dHRvbnMpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMucmVzZXRBbmltYXRpb25TdGF0ZSgpO1xuICAgICAgICB0aGlzLm1pbmlGYWJWaXNpYmxlID0gdHJ1ZTtcblxuICAgICAgICB0aGlzLnNob3dNaW5pRmFiQW5pbWF0aW9uID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLl9idXR0b25zLmZvckVhY2goKGJ1dHRvbiwgaSkgPT4ge1xuICAgICAgICAgICAgICAgIGxldCB0cmFuc2l0aW9uRGVsYXkgPSAwO1xuICAgICAgICAgICAgICAgIGxldCB0cmFuc2Zvcm07XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX3BhcmVudC5hbmltYXRpb25Nb2RlID09PSAnc2NhbGUnKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEluY3JlbWVudGFsIHRyYW5zaXRpb24gZGVsYXkgb2YgNjVtcyBmb3IgZWFjaCBhY3Rpb24gYnV0dG9uXG4gICAgICAgICAgICAgICAgICAgIHRyYW5zaXRpb25EZWxheSA9IDMgKyAoNjUgKiBpKTtcbiAgICAgICAgICAgICAgICAgICAgdHJhbnNmb3JtID0gJ3NjYWxlKDEpJztcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm0gPSB0aGlzLmdldFRyYW5zbGF0ZUZ1bmN0aW9uKCcwJyk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY29uc3QgaG9zdEVsZW1lbnQgPSBidXR0b24uX2dldEhvc3RFbGVtZW50KCk7XG4gICAgICAgICAgICAgICAgdGhpcy5jaGFuZ2VFbGVtZW50U3R5bGUoaG9zdEVsZW1lbnQsICd0cmFuc2l0aW9uLWRlbGF5JywgdHJhbnNpdGlvbkRlbGF5ICsgJ21zJyk7XG4gICAgICAgICAgICAgICAgdGhpcy5jaGFuZ2VFbGVtZW50U3R5bGUoaG9zdEVsZW1lbnQsICdvcGFjaXR5JywgJzEnKTtcbiAgICAgICAgICAgICAgICB0aGlzLmNoYW5nZUVsZW1lbnRTdHlsZShob3N0RWxlbWVudCwgJ3RyYW5zZm9ybScsIHRyYW5zZm9ybSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSwgNTApOyAvLyBCZSBzdXJlIHRoYXQgKm5nSWYgY2FuIHNob3cgZWxlbWVudHMgYmVmb3JlIHRyeWluZyB0byBhbmltYXRlIHRoZW1cbiAgICB9XG5cbiAgICBwcml2YXRlIHJlc2V0QW5pbWF0aW9uU3RhdGUoKTogdm9pZCB7XG4gICAgICAgIGNsZWFyVGltZW91dCh0aGlzLnNob3dNaW5pRmFiQW5pbWF0aW9uKTtcbiAgICAgICAgaWYgKHRoaXMuaGlkZU1pbmlGYWIpIHtcbiAgICAgICAgICAgIHRoaXMuaGlkZU1pbmlGYWIudW5zdWJzY3JpYmUoKTtcbiAgICAgICAgICAgIHRoaXMuaGlkZU1pbmlGYWIgPSBudWxsO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaGlkZSgpOiB2b2lkIHtcbiAgICAgICAgaWYgKCF0aGlzLl9idXR0b25zKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnJlc2V0QW5pbWF0aW9uU3RhdGUoKTtcblxuICAgICAgICBjb25zdCBvYnMgPSB0aGlzLl9idXR0b25zLm1hcCgoYnV0dG9uLCBpKSA9PiB7XG4gICAgICAgICAgICBsZXQgb3BhY2l0eSA9ICcxJztcbiAgICAgICAgICAgIGxldCB0cmFuc2l0aW9uRGVsYXkgPSAwO1xuICAgICAgICAgICAgbGV0IHRyYW5zZm9ybTtcblxuICAgICAgICAgICAgaWYgKHRoaXMuX3BhcmVudC5hbmltYXRpb25Nb2RlID09PSAnc2NhbGUnKSB7XG4gICAgICAgICAgICAgICAgdHJhbnNpdGlvbkRlbGF5ID0gMyAtICg2NSAqIGkpO1xuICAgICAgICAgICAgICAgIHRyYW5zZm9ybSA9ICdzY2FsZSgwKSc7XG4gICAgICAgICAgICAgICAgb3BhY2l0eSA9ICcwJztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdHJhbnNmb3JtID0gdGhpcy5nZXRUcmFuc2xhdGVGdW5jdGlvbigoNTUgKiAoaSArIDEpIC0gKGkgKiA1KSkgKyAncHgnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3QgaG9zdEVsZW1lbnQgPSBidXR0b24uX2dldEhvc3RFbGVtZW50KCk7XG5cbiAgICAgICAgICAgIHRoaXMuY2hhbmdlRWxlbWVudFN0eWxlKGhvc3RFbGVtZW50LCAndHJhbnNpdGlvbi1kZWxheScsIHRyYW5zaXRpb25EZWxheSArICdtcycpO1xuICAgICAgICAgICAgdGhpcy5jaGFuZ2VFbGVtZW50U3R5bGUoaG9zdEVsZW1lbnQsICdvcGFjaXR5Jywgb3BhY2l0eSk7XG4gICAgICAgICAgICB0aGlzLmNoYW5nZUVsZW1lbnRTdHlsZShob3N0RWxlbWVudCwgJ3RyYW5zZm9ybScsIHRyYW5zZm9ybSk7XG5cbiAgICAgICAgICAgIHJldHVybiBmcm9tRXZlbnQoaG9zdEVsZW1lbnQsICd0cmFuc2l0aW9uZW5kJykucGlwZSh0YWtlKDEpKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gV2FpdCBmb3IgYWxsIGFuaW1hdGlvbiB0byBmaW5pc2gsIHRoZW4gZGVzdHJveSB0aGVpciBlbGVtZW50c1xuICAgICAgICB0aGlzLmhpZGVNaW5pRmFiID0gZm9ya0pvaW4ob2JzKS5zdWJzY3JpYmUoKCkgPT4gdGhpcy5taW5pRmFiVmlzaWJsZSA9IGZhbHNlKTtcblxuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0VHJhbnNsYXRlRnVuY3Rpb24odmFsdWU6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICAgIGNvbnN0IGRpciA9IHRoaXMuX3BhcmVudC5kaXJlY3Rpb247XG4gICAgICAgIGNvbnN0IHRyYW5zbGF0ZUZuID0gKGRpciA9PT0gJ3VwJyB8fCBkaXIgPT09ICdkb3duJykgPyAndHJhbnNsYXRlWScgOiAndHJhbnNsYXRlWCc7XG4gICAgICAgIGNvbnN0IHNpZ24gPSAoZGlyID09PSAnZG93bicgfHwgZGlyID09PSAncmlnaHQnKSA/ICctJyA6ICcnO1xuXG4gICAgICAgIHJldHVybiB0cmFuc2xhdGVGbiArICcoJyArIHNpZ24gKyB2YWx1ZSArICcpJztcbiAgICB9XG5cbiAgICBwcml2YXRlIGNoYW5nZUVsZW1lbnRTdHlsZShlbGVtOiBhbnksIHN0eWxlOiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcpIHtcbiAgICAgICAgLy8gRklYTUUgLSBGaW5kIGEgd2F5IHRvIGNyZWF0ZSBhIFwid3JhcHBlclwiIGFyb3VuZCB0aGUgYWN0aW9uIGJ1dHRvbihzKSBwcm92aWRlZCBieSB0aGUgdXNlciwgc28gd2UgZG9uJ3QgY2hhbmdlIGl0J3Mgc3R5bGUgdGFnXG4gICAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUoZWxlbSwgc3R5bGUsIHZhbHVlKTtcbiAgICB9XG59XG5cbi8qKiBAZHluYW1pYyBAc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9hbmd1bGFyL2FuZ3VsYXIvaXNzdWVzLzIwMzUxI2lzc3VlY29tbWVudC0zNDQwMDk4ODcgKi9cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAnZWNvLWZhYi1zcGVlZC1kaWFsJyxcbiAgICB0ZW1wbGF0ZTogYFxuICAgICAgICA8ZGl2IGNsYXNzPVwiZWNvLWZhYi1zcGVlZC1kaWFsLWNvbnRhaW5lclwiPlxuICAgICAgICAgICAgPG5nLWNvbnRlbnQgc2VsZWN0PVwiZWNvLWZhYi1zcGVlZC1kaWFsLXRyaWdnZXJcIj48L25nLWNvbnRlbnQ+XG4gICAgICAgICAgICA8bmctY29udGVudCBzZWxlY3Q9XCJlY28tZmFiLXNwZWVkLWRpYWwtYWN0aW9uc1wiPjwvbmctY29udGVudD5cbiAgICAgICAgPC9kaXY+XG4gICAgYCxcbiAgICBzdHlsZVVybHM6IFsnZmFiLXNwZWVkLWRpYWwuc2NzcyddLFxuICAgIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmUsXG59KVxuZXhwb3J0IGNsYXNzIEVjb0ZhYlNwZWVkRGlhbENvbXBvbmVudCBpbXBsZW1lbnRzIE9uRGVzdHJveSwgQWZ0ZXJDb250ZW50SW5pdCB7XG4gICAgcHJpdmF0ZSBpc0luaXRpYWxpemVkID0gZmFsc2U7XG4gICAgcHJpdmF0ZSBfZGlyZWN0aW9uOiBEaXJlY3Rpb24gPSAndXAnO1xuICAgIHByaXZhdGUgX29wZW4gPSBmYWxzZTtcbiAgICBwcml2YXRlIF9hbmltYXRpb25Nb2RlOiBBbmltYXRpb25Nb2RlID0gJ2ZsaW5nJztcbiAgICBwcml2YXRlIF9maXhlZCA9IGZhbHNlO1xuICAgIHByaXZhdGUgX2RvY3VtZW50Q2xpY2tVbmxpc3RlbmVyOiAoKCkgPT4gdm9pZCkgfCBudWxsID0gbnVsbDtcblxuICAgIC8qKlxuICAgICAqIFdoZXRoZXIgdGhpcyBzcGVlZCBkaWFsIGlzIGZpeGVkIG9uIHNjcmVlbiAodXNlciBjYW5ub3QgY2hhbmdlIGl0IGJ5IGNsaWNraW5nKVxuICAgICAqL1xuICAgIEBJbnB1dCgpIGdldCBmaXhlZCgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2ZpeGVkO1xuICAgIH1cblxuICAgIHNldCBmaXhlZChmaXhlZDogYm9vbGVhbikge1xuICAgICAgICB0aGlzLl9maXhlZCA9IGZpeGVkO1xuICAgICAgICB0aGlzLl9wcm9jZXNzT3V0c2lkZUNsaWNrU3RhdGUoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBXaGV0aGVyIHRoaXMgc3BlZWQgZGlhbCBpcyBvcGVuZWRcbiAgICAgKi9cbiAgICBASG9zdEJpbmRpbmcoJ2NsYXNzLmVjby1vcGVuZWQnKVxuICAgIEBJbnB1dCgpIGdldCBvcGVuKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5fb3BlbjtcbiAgICB9XG5cbiAgICBzZXQgb3BlbihvcGVuOiBib29sZWFuKSB7XG4gICAgICAgIGNvbnN0IHByZXZpb3VzT3BlbiA9IHRoaXMuX29wZW47XG4gICAgICAgIHRoaXMuX29wZW4gPSBvcGVuO1xuICAgICAgICBpZiAocHJldmlvdXNPcGVuICE9PSB0aGlzLl9vcGVuKSB7XG4gICAgICAgICAgICB0aGlzLm9wZW5DaGFuZ2UuZW1pdCh0aGlzLl9vcGVuKTtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzSW5pdGlhbGl6ZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldEFjdGlvbnNWaXNpYmlsaXR5KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUaGUgZGlyZWN0aW9uIG9mIHRoZSBzcGVlZCBkaWFsLiBDYW4gYmUgJ3VwJywgJ2Rvd24nLCAnbGVmdCcgb3IgJ3JpZ2h0J1xuICAgICAqL1xuICAgIEBJbnB1dCgpIGdldCBkaXJlY3Rpb24oKTogRGlyZWN0aW9uIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2RpcmVjdGlvbjtcbiAgICB9XG5cbiAgICBzZXQgZGlyZWN0aW9uKGRpcmVjdGlvbjogRGlyZWN0aW9uKSB7XG4gICAgICAgIGNvbnN0IHByZXZpb3VzRGlyZWN0aW9uID0gdGhpcy5fZGlyZWN0aW9uO1xuICAgICAgICB0aGlzLl9kaXJlY3Rpb24gPSBkaXJlY3Rpb247XG4gICAgICAgIGlmIChwcmV2aW91c0RpcmVjdGlvbiAhPT0gdGhpcy5kaXJlY3Rpb24pIHtcbiAgICAgICAgICAgIHRoaXMuX3NldEVsZW1lbnRDbGFzcyhwcmV2aW91c0RpcmVjdGlvbiwgZmFsc2UpO1xuICAgICAgICAgICAgdGhpcy5fc2V0RWxlbWVudENsYXNzKHRoaXMuZGlyZWN0aW9uLCB0cnVlKTtcblxuICAgICAgICAgICAgaWYgKHRoaXMuaXNJbml0aWFsaXplZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0QWN0aW9uc1Zpc2liaWxpdHkoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoZSBhbmltYXRpb24gbW9kZSB0byBvcGVuIHRoZSBzcGVlZCBkaWFsLiBDYW4gYmUgJ2ZsaW5nJyBvciAnc2NhbGUnXG4gICAgICovXG4gICAgQElucHV0KCkgZ2V0IGFuaW1hdGlvbk1vZGUoKTogQW5pbWF0aW9uTW9kZSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9hbmltYXRpb25Nb2RlO1xuICAgIH1cblxuICAgIHNldCBhbmltYXRpb25Nb2RlKGFuaW1hdGlvbk1vZGU6IEFuaW1hdGlvbk1vZGUpIHtcbiAgICAgICAgY29uc3QgcHJldmlvdXNBbmltYXRpb25Nb2RlID0gdGhpcy5fYW5pbWF0aW9uTW9kZTtcbiAgICAgICAgdGhpcy5fYW5pbWF0aW9uTW9kZSA9IGFuaW1hdGlvbk1vZGU7XG4gICAgICAgIGlmIChwcmV2aW91c0FuaW1hdGlvbk1vZGUgIT09IHRoaXMuX2FuaW1hdGlvbk1vZGUpIHtcbiAgICAgICAgICAgIHRoaXMuX3NldEVsZW1lbnRDbGFzcyhwcmV2aW91c0FuaW1hdGlvbk1vZGUsIGZhbHNlKTtcbiAgICAgICAgICAgIHRoaXMuX3NldEVsZW1lbnRDbGFzcyh0aGlzLmFuaW1hdGlvbk1vZGUsIHRydWUpO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5pc0luaXRpYWxpemVkKSB7XG4gICAgICAgICAgICAgICAgLy8gVG8gc3RhcnQgYW5vdGhlciBkZXRlY3QgbGlmZWN5Y2xlIGFuZCBmb3JjZSB0aGUgXCJjbG9zZVwiIG9uIHRoZSBhY3Rpb24gYnV0dG9uc1xuICAgICAgICAgICAgICAgIFByb21pc2UucmVzb2x2ZShudWxsKS50aGVuKCgpID0+IHRoaXMub3BlbiA9IGZhbHNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIEBPdXRwdXQoKSBvcGVuQ2hhbmdlOiBFdmVudEVtaXR0ZXI8Ym9vbGVhbj4gPSBuZXcgRXZlbnRFbWl0dGVyPGJvb2xlYW4+KCk7XG5cbiAgICBAQ29udGVudENoaWxkKEVjb0ZhYlNwZWVkRGlhbEFjdGlvbnNDb21wb25lbnQsIHtzdGF0aWM6IGZhbHNlfSkgX2NoaWxkQWN0aW9uczogRWNvRmFiU3BlZWREaWFsQWN0aW9uc0NvbXBvbmVudDtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgZWxlbWVudFJlZjogRWxlbWVudFJlZiwgcHJpdmF0ZSByZW5kZXJlcjogUmVuZGVyZXIyLCBASW5qZWN0KERPQ1VNRU5UKSBwcml2YXRlIGRvY3VtZW50OiBEb2N1bWVudCkge1xuICAgIH1cblxuICAgIG5nQWZ0ZXJDb250ZW50SW5pdCgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5pc0luaXRpYWxpemVkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5zZXRBY3Rpb25zVmlzaWJpbGl0eSgpO1xuICAgICAgICB0aGlzLl9zZXRFbGVtZW50Q2xhc3ModGhpcy5kaXJlY3Rpb24sIHRydWUpO1xuICAgICAgICB0aGlzLl9zZXRFbGVtZW50Q2xhc3ModGhpcy5hbmltYXRpb25Nb2RlLCB0cnVlKTtcbiAgICB9XG5cbiAgICBuZ09uRGVzdHJveSgpIHtcbiAgICAgICAgdGhpcy5fdW5zZXREb2N1bWVudENsaWNrTGlzdGVuZXIoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUb2dnbGUgdGhlIG9wZW4gc3RhdGUgb2YgdGhpcyBzcGVlZCBkaWFsXG4gICAgICovXG4gICAgcHVibGljIHRvZ2dsZSgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5vcGVuID0gIXRoaXMub3BlbjtcbiAgICB9XG5cbiAgICBASG9zdExpc3RlbmVyKCdjbGljaycpXG4gICAgX29uQ2xpY2soKTogdm9pZCB7XG4gICAgICAgIGlmICghdGhpcy5maXhlZCAmJiB0aGlzLm9wZW4pIHtcbiAgICAgICAgICAgIHRoaXMub3BlbiA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgc2V0QWN0aW9uc1Zpc2liaWxpdHkoKTogdm9pZCB7XG4gICAgICAgIGlmICghdGhpcy5fY2hpbGRBY3Rpb25zKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5vcGVuKSB7XG4gICAgICAgICAgICB0aGlzLl9jaGlsZEFjdGlvbnMuc2hvdygpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5fY2hpbGRBY3Rpb25zLmhpZGUoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9wcm9jZXNzT3V0c2lkZUNsaWNrU3RhdGUoKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIF9zZXRFbGVtZW50Q2xhc3MoZWxlbUNsYXNzOiBzdHJpbmcsIGlzQWRkOiBib29sZWFuKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IGZpbmFsQ2xhc3MgPSBgZWNvLSR7ZWxlbUNsYXNzfWA7XG4gICAgICAgIGlmIChpc0FkZCkge1xuICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyh0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCwgZmluYWxDbGFzcyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnJlbmRlcmVyLnJlbW92ZUNsYXNzKHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LCBmaW5hbENsYXNzKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgX3Byb2Nlc3NPdXRzaWRlQ2xpY2tTdGF0ZSgpIHtcbiAgICAgICAgaWYgKCF0aGlzLmZpeGVkICYmIHRoaXMub3Blbikge1xuICAgICAgICAgICAgdGhpcy5fc2V0RG9jdW1lbnRDbGlja0xpc3RlbmVyKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl91bnNldERvY3VtZW50Q2xpY2tMaXN0ZW5lcigpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfc2V0RG9jdW1lbnRDbGlja0xpc3RlbmVyKCkge1xuICAgICAgICBpZiAoIXRoaXMuX2RvY3VtZW50Q2xpY2tVbmxpc3RlbmVyKSB7XG4gICAgICAgICAgICB0aGlzLl9kb2N1bWVudENsaWNrVW5saXN0ZW5lciA9IHRoaXMucmVuZGVyZXIubGlzdGVuKHRoaXMuZG9jdW1lbnQsICdjbGljaycsICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLm9wZW4gPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfdW5zZXREb2N1bWVudENsaWNrTGlzdGVuZXIoKSB7XG4gICAgICAgIGlmICh0aGlzLl9kb2N1bWVudENsaWNrVW5saXN0ZW5lcikge1xuICAgICAgICAgICAgdGhpcy5fZG9jdW1lbnRDbGlja1VubGlzdGVuZXIoKTtcbiAgICAgICAgICAgIHRoaXMuX2RvY3VtZW50Q2xpY2tVbmxpc3RlbmVyID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cblxufVxuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ2Vjby1mYWItc3BlZWQtZGlhbC10cmlnZ2VyJyxcbiAgICB0ZW1wbGF0ZTogYFxuICAgICAgICA8bmctY29udGVudCBzZWxlY3Q9XCJbbWF0LWZhYl1cIj48L25nLWNvbnRlbnQ+YCxcbn0pXG5leHBvcnQgY2xhc3MgRWNvRmFiU3BlZWREaWFsVHJpZ2dlckNvbXBvbmVudCB7XG4gICAgcHJpdmF0ZSBfcGFyZW50OiBFY29GYWJTcGVlZERpYWxDb21wb25lbnQ7XG5cbiAgICAvKipcbiAgICAgKiBXaGV0aGVyIHRoaXMgdHJpZ2dlciBzaG91bGQgc3BpbiAoMzYwZGcpIHdoaWxlIG9wZW5pbmcgdGhlIHNwZWVkIGRpYWxcbiAgICAgKi9cbiAgICBASG9zdEJpbmRpbmcoJ2NsYXNzLmVjby1zcGluJykgZ2V0IHNwKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zcGluO1xuICAgIH1cblxuICAgIEBJbnB1dCgpIHNwaW4gPSBmYWxzZTtcblxuICAgIGNvbnN0cnVjdG9yKGluamVjdG9yOiBJbmplY3Rvcikge1xuICAgICAgICB0aGlzLl9wYXJlbnQgPSBpbmplY3Rvci5nZXQoRWNvRmFiU3BlZWREaWFsQ29tcG9uZW50KTtcbiAgICB9XG5cbiAgICBASG9zdExpc3RlbmVyKCdjbGljaycsIFsnJGV2ZW50J10pXG4gICAgX29uQ2xpY2soZXZlbnQ6IEV2ZW50KTogdm9pZCB7XG4gICAgICAgIGlmICghdGhpcy5fcGFyZW50LmZpeGVkKSB7XG4gICAgICAgICAgICB0aGlzLl9wYXJlbnQudG9nZ2xlKCk7XG4gICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgfVxuICAgIH1cblxufVxuIl19